-- ============================================================
-- 修复密码哈希脚本
-- ============================================================
-- 问题：数据库中的密码哈希不是密码"123456"的正确BCrypt哈希
-- 解决方案：使用正确的BCrypt哈希更新所有用户的密码
-- ============================================================

USE hpims;

-- ============================================================
-- 方法1：使用后端应用生成正确的哈希（推荐）
-- ============================================================
-- 1. 确保后端应用正在运行
-- 2. 在浏览器中访问: http://localhost:8080/api/auth/generate-hash?password=123456
-- 3. 复制返回的SQL UPDATE语句
-- 4. 在MySQL中执行该SQL语句

-- ============================================================
-- 方法2：手动生成并更新（如果方法1不可用）
-- ============================================================
-- 使用以下Python脚本生成正确的BCrypt哈希：
-- python database/generate_password_hash.py
-- 然后使用生成的SQL语句更新数据库

-- ============================================================
-- 方法3：使用注册功能重新创建用户（临时方案）
-- ============================================================
-- 1. 先删除现有用户（如果需要）
-- DELETE FROM users WHERE username IN ('admin', 'doctor', 'pharmacist');
-- 
-- 2. 使用注册API创建新用户（会生成正确的密码哈希）
-- POST http://localhost:8080/api/auth/register
-- {
--   "username": "admin",
--   "password": "123456",
--   "role": "admin",
--   "realName": "系统管理员",
--   "department": "信息部"
-- }

-- ============================================================
-- 验证修复结果
-- ============================================================
-- 执行以下SQL验证密码哈希格式：
SELECT 
    username,
    LENGTH(password) as password_length,
    CASE 
        WHEN password LIKE '$2a$10$%' AND LENGTH(password) = 60 THEN '✓ 格式正确'
        ELSE '✗ 格式错误'
    END as format_check
FROM users 
WHERE username IN ('admin', 'doctor', 'pharmacist');
